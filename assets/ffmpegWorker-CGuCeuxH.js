var y=Object.defineProperty;var _=t=>{throw TypeError(t)};var T=(t,n,E)=>n in t?y(t,n,{enumerable:!0,configurable:!0,writable:!0,value:E}):t[n]=E;var c=(t,n,E)=>T(t,typeof n!="symbol"?n+"":n,E),p=(t,n,E)=>n.has(t)||_("Cannot "+E);var i=(t,n,E)=>(p(t,n,"read from private field"),E?E.call(t):n.get(t)),D=(t,n,E)=>n.has(t)?_("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,E),I=(t,n,E,A)=>(p(t,n,"write to private field"),A?A.call(t,E):n.set(t,E),E);(function(){"use strict";var R,h,d,u,O,m,f;var t;(function(s){s.LOAD="LOAD",s.EXEC="EXEC",s.FFPROBE="FFPROBE",s.WRITE_FILE="WRITE_FILE",s.READ_FILE="READ_FILE",s.DELETE_FILE="DELETE_FILE",s.RENAME="RENAME",s.CREATE_DIR="CREATE_DIR",s.LIST_DIR="LIST_DIR",s.DELETE_DIR="DELETE_DIR",s.ERROR="ERROR",s.DOWNLOAD="DOWNLOAD",s.PROGRESS="PROGRESS",s.LOG="LOG",s.MOUNT="MOUNT",s.UNMOUNT="UNMOUNT"})(t||(t={}));const n=(()=>{let s=0;return()=>s++})(),E=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),A=new Error("called FFmpeg.terminate()");class N{constructor(){D(this,R,null);D(this,h,{});D(this,d,{});D(this,u,[]);D(this,O,[]);c(this,"loaded",!1);D(this,m,()=>{i(this,R)&&(i(this,R).onmessage=({data:{id:e,type:r,data:a}})=>{switch(r){case t.LOAD:this.loaded=!0,i(this,h)[e](a);break;case t.MOUNT:case t.UNMOUNT:case t.EXEC:case t.FFPROBE:case t.WRITE_FILE:case t.READ_FILE:case t.DELETE_FILE:case t.RENAME:case t.CREATE_DIR:case t.LIST_DIR:case t.DELETE_DIR:i(this,h)[e](a);break;case t.LOG:i(this,u).forEach(o=>o(a));break;case t.PROGRESS:i(this,O).forEach(o=>o(a));break;case t.ERROR:i(this,d)[e](a);break}delete i(this,h)[e],delete i(this,d)[e]})});D(this,f,({type:e,data:r},a=[],o)=>i(this,R)?new Promise((L,l)=>{const w=n();i(this,R)&&i(this,R).postMessage({id:w,type:e,data:r},a),i(this,h)[w]=L,i(this,d)[w]=l,o==null||o.addEventListener("abort",()=>{l(new DOMException(`Message # ${w} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(E));c(this,"load",({classWorkerURL:e,...r}={},{signal:a}={})=>(i(this,R)||(I(this,R,e?new Worker(new URL(e,self.location.href),{type:"module"}):new Worker(new URL(""+new URL("worker-BAOIWoxA.js",self.location.href).href,self.location.href),{type:"module"})),i(this,m).call(this)),i(this,f).call(this,{type:t.LOAD,data:r},void 0,a)));c(this,"exec",(e,r=-1,{signal:a}={})=>i(this,f).call(this,{type:t.EXEC,data:{args:e,timeout:r}},void 0,a));c(this,"ffprobe",(e,r=-1,{signal:a}={})=>i(this,f).call(this,{type:t.FFPROBE,data:{args:e,timeout:r}},void 0,a));c(this,"terminate",()=>{const e=Object.keys(i(this,d));for(const r of e)i(this,d)[r](A),delete i(this,d)[r],delete i(this,h)[r];i(this,R)&&(i(this,R).terminate(),I(this,R,null),this.loaded=!1)});c(this,"writeFile",(e,r,{signal:a}={})=>{const o=[];return r instanceof Uint8Array&&o.push(r.buffer),i(this,f).call(this,{type:t.WRITE_FILE,data:{path:e,data:r}},o,a)});c(this,"mount",(e,r,a)=>{const o=[];return i(this,f).call(this,{type:t.MOUNT,data:{fsType:e,options:r,mountPoint:a}},o)});c(this,"unmount",e=>{const r=[];return i(this,f).call(this,{type:t.UNMOUNT,data:{mountPoint:e}},r)});c(this,"readFile",(e,r="binary",{signal:a}={})=>i(this,f).call(this,{type:t.READ_FILE,data:{path:e,encoding:r}},void 0,a));c(this,"deleteFile",(e,{signal:r}={})=>i(this,f).call(this,{type:t.DELETE_FILE,data:{path:e}},void 0,r));c(this,"rename",(e,r,{signal:a}={})=>i(this,f).call(this,{type:t.RENAME,data:{oldPath:e,newPath:r}},void 0,a));c(this,"createDir",(e,{signal:r}={})=>i(this,f).call(this,{type:t.CREATE_DIR,data:{path:e}},void 0,r));c(this,"listDir",(e,{signal:r}={})=>i(this,f).call(this,{type:t.LIST_DIR,data:{path:e}},void 0,r));c(this,"deleteDir",(e,{signal:r}={})=>i(this,f).call(this,{type:t.DELETE_DIR,data:{path:e}},void 0,r))}on(e,r){e==="log"?i(this,u).push(r):e==="progress"&&i(this,O).push(r)}off(e,r){e==="log"?I(this,u,i(this,u).filter(a=>a!==r)):e==="progress"&&I(this,O,i(this,O).filter(a=>a!==r))}}R=new WeakMap,h=new WeakMap,d=new WeakMap,u=new WeakMap,O=new WeakMap,m=new WeakMap,f=new WeakMap;var U;(function(s){s.MEMFS="MEMFS",s.NODEFS="NODEFS",s.NODERAWFS="NODERAWFS",s.IDBFS="IDBFS",s.WORKERFS="WORKERFS",s.PROXYFS="PROXYFS"})(U||(U={}));const b=s=>new Promise((e,r)=>{const a=new FileReader;a.onload=()=>{const{result:o}=a;o instanceof ArrayBuffer?e(new Uint8Array(o)):e(new Uint8Array)},a.onerror=o=>{var L,l;r(Error(`File could not be read! Code=${((l=(L=o==null?void 0:o.target)==null?void 0:L.error)==null?void 0:l.code)||-1}`))},a.readAsArrayBuffer(s)}),g=async s=>{let e;if(typeof s=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(s)?e=atob(s.split(",")[1]).split("").map(r=>r.charCodeAt(0)):e=await(await fetch(s)).arrayBuffer();else if(s instanceof URL)e=await(await fetch(s)).arrayBuffer();else if(s instanceof File||s instanceof Blob)e=await b(s);else return new Uint8Array;return new Uint8Array(e)};onmessage=async s=>{const{video:e}=s.data,r=new N;await r.load(),r.on("progress",({progress:B})=>{postMessage({progress:B})}),await r.writeFile("test.mp4",await g(e)),await r.exec(["-ss","1.0","-i","test.mp4","-frames:v","1","out.png"]);const a=await r.readFile("out.png"),o=new Uint8Array(a),L=URL.createObjectURL(new Blob([o.buffer],{type:"image/png"}));await r.exec(["-i","test.mp4","-t","2.5","-ss","2.0","-f","gif","out.gif"]);const l=await r.readFile("out.gif"),w=new Uint8Array(l),S=URL.createObjectURL(new Blob([w.buffer],{type:"image/gif"}));postMessage({img:a,imgUrl:L,gif:l,gifUrl:S}),postMessage({finished:!0})}})();
